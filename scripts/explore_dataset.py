"""
Food-101 ë°ì´í„°ì…‹ êµ¬ì¡° íƒìƒ‰ ìŠ¤í¬ë¦½íŠ¸

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìš´ë¡œë“œëœ Food-101 ë°ì´í„°ì…‹ì˜ êµ¬ì¡°ë¥¼ ìƒì„¸íˆ ë¶„ì„í•˜ê³ ,
í´ë˜ìŠ¤ë³„ ì´ë¯¸ì§€ ìˆ˜, í›ˆë ¨/í…ŒìŠ¤íŠ¸ ë¶„í•  ì •ë³´ ë“±ì„ í™•ì¸í•©ë‹ˆë‹¤.

ì‘ì„±ì¼: 2025
ëª©ì : ë°ì´í„°ì…‹ì˜ êµ¬ì¡°ì™€ í†µê³„ë¥¼ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸
"""

# ============================================================================
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
# ============================================================================
import os  # ìš´ì˜ì²´ì œ ê´€ë ¨ ê¸°ëŠ¥ (í˜„ì¬ëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í–¥í›„ í™•ì¥ìš©)
from pathlib import Path  # ê²½ë¡œë¥¼ ê°ì²´ì§€í–¥ì ìœ¼ë¡œ ë‹¤ë£¨ê¸° ìœ„í•œ ëª¨ë“ˆ
from collections import Counter  # ìš”ì†Œì˜ ë¹ˆë„ë¥¼ ì„¸ëŠ” ë”•ì…”ë„ˆë¦¬ (í˜„ì¬ëŠ” ì‚¬ìš© ì•ˆí•¨)
import json  # JSON íŒŒì¼ ì½ê¸°/ì“°ê¸°ë¥¼ ìœ„í•œ ëª¨ë“ˆ


def load_dataset_path():
    """
    download_dataset.pyì—ì„œ ì €ì¥í•œ ë°ì´í„°ì…‹ ê²½ë¡œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜

    ë™ì‘ ê³¼ì •:
    1. dataset_path.txt íŒŒì¼ì„ ì½ì–´ì„œ ê²½ë¡œ ë¬¸ìì—´ì„ ê°€ì ¸ì˜´
    2. íŒŒì¼ì´ ì—†ìœ¼ë©´ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥ í›„ None ë°˜í™˜

    Returns:
        str or None: ë°ì´í„°ì…‹ ê²½ë¡œ (íŒŒì¼ì´ ì—†ìœ¼ë©´ None)

    ì£¼ì˜ì‚¬í•­:
        - ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— download_dataset.pyë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì•¼ í•¨
        - dataset_path.txt íŒŒì¼ì´ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ì— ìˆì–´ì•¼ í•¨
    """
    try:
        # í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì½ê¸° ëª¨ë“œë¡œ ì—´ê¸°
        with open("dataset_path.txt", "r") as f:
            # strip()ìœ¼ë¡œ ì•ë’¤ ê³µë°±/ì¤„ë°”ê¿ˆ ì œê±° í›„ ë°˜í™˜
            return f.read().strip()

    except FileNotFoundError:
        # íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´ ë©”ì‹œì§€ ì¶œë ¥
        print("âŒ ë°ì´í„°ì…‹ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        print("ë¨¼ì € 'python download_dataset.py'ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.")
        return None


def explore_food101_dataset(dataset_path):
    """
    Food-101 ë°ì´í„°ì…‹ì˜ êµ¬ì¡°ë¥¼ ìƒì„¸íˆ íƒìƒ‰í•˜ê³  ë¶„ì„í•˜ëŠ” í•¨ìˆ˜

    ë™ì‘ ê³¼ì •:
    1. Meta ë””ë ‰í† ë¦¬ ë¶„ì„ (classes.txt, train.txt, test.txt)
    2. Images ë””ë ‰í† ë¦¬ ë¶„ì„ (ê° í´ë˜ìŠ¤ë³„ ì´ë¯¸ì§€ ìˆ˜ í™•ì¸)
    3. ì „ì²´ í†µê³„ ê³„ì‚° ë° ì¶œë ¥
    4. ê²°ê³¼ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥

    Args:
        dataset_path (str): Food-101 ë°ì´í„°ì…‹ì˜ ë£¨íŠ¸ ê²½ë¡œ

    ì£¼ì˜ì‚¬í•­:
        - ì „ì²´ 101ê°œ í´ë˜ìŠ¤ì˜ ì´ë¯¸ì§€ ìˆ˜ë¥¼ ì„¸ë¯€ë¡œ ì‹¤í–‰ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŒ
        - dataset_summary.json íŒŒì¼ì´ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ìƒì„±ë¨
    """
    # ë¬¸ìì—´ ê²½ë¡œë¥¼ Path ê°ì²´ë¡œ ë³€í™˜ (ê²½ë¡œ ì¡°ì‘ì´ ë” í¸ë¦¬í•¨)
    dataset_path = Path(dataset_path)

    # ê²½ë¡œê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    if not dataset_path.exists():
        print(f"âŒ ê²½ë¡œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {dataset_path}")
        return  # ê²½ë¡œê°€ ì—†ìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ

    # ------------------------------------------------------------------------
    # ë¶„ì„ ì‹œì‘ í—¤ë” ì¶œë ¥
    # ------------------------------------------------------------------------
    print("=" * 70)
    print("Food-101 ë°ì´í„°ì…‹ ìƒì„¸ ë¶„ì„")
    print("=" * 70)

    # ========================================================================
    # 1ë‹¨ê³„: Meta íŒŒì¼ ë¶„ì„
    # ========================================================================
    # meta ë””ë ‰í† ë¦¬: classes.txt, train.txt, test.txt ë“±ì„ í¬í•¨
    meta_dir = dataset_path / "meta"

    if meta_dir.exists():
        print("\nğŸ“‹ Meta íŒŒì¼ ë¶„ì„:")
        print("-" * 70)

        # --------------------------------------------------------------------
        # 1-1. classes.txt ë¶„ì„
        # --------------------------------------------------------------------
        # classes.txt: 101ê°œ ìŒì‹ ì¹´í…Œê³ ë¦¬ ì´ë¦„ì´ ì¤„ë§ˆë‹¤ í•˜ë‚˜ì”© ì €ì¥ë¨
        classes_file = meta_dir / "classes.txt"

        if classes_file.exists():
            # íŒŒì¼ì„ ì—´ì–´ ê° ì¤„ì„ ì½ì–´ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“¤ê¸°
            with open(classes_file, "r") as f:
                # strip()ìœ¼ë¡œ ê° ì¤„ì˜ ì•ë’¤ ê³µë°± ì œê±°
                classes = [line.strip() for line in f.readlines()]

            # í´ë˜ìŠ¤ ì •ë³´ ì¶œë ¥
            print(f"âœ“ ì´ í´ë˜ìŠ¤ ìˆ˜: {len(classes)}")
            # ì²˜ìŒ 10ê°œ í´ë˜ìŠ¤ ì´ë¦„ì„ ì½¤ë§ˆë¡œ êµ¬ë¶„í•˜ì—¬ ì¶œë ¥
            print(f"  ì²˜ìŒ 10ê°œ í´ë˜ìŠ¤: {', '.join(classes[:10])}")
            # ë§ˆì§€ë§‰ 10ê°œ í´ë˜ìŠ¤ ì´ë¦„ ì¶œë ¥
            print(f"  ë§ˆì§€ë§‰ 10ê°œ í´ë˜ìŠ¤: {', '.join(classes[-10:])}")

        # --------------------------------------------------------------------
        # 1-2. train.txt ë¶„ì„
        # --------------------------------------------------------------------
        # train.txt: í›ˆë ¨ìš© ì´ë¯¸ì§€ì˜ ê²½ë¡œê°€ ì¤„ë§ˆë‹¤ í•˜ë‚˜ì”© ì €ì¥ë¨
        # ì˜ˆ: "apple_pie/3774535", "baby_back_ribs/4341686" ...
        train_file = meta_dir / "train.txt"

        if train_file.exists():
            # íŒŒì¼ì„ ì½ì–´ì„œ ê° ì¤„(ì´ë¯¸ì§€ ê²½ë¡œ)ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥
            with open(train_file, "r") as f:
                train_images = [line.strip() for line in f.readlines()]

            # í›ˆë ¨ ì´ë¯¸ì§€ í†µê³„ ì¶œë ¥ (ì²œ ë‹¨ìœ„ êµ¬ë¶„ ì‰¼í‘œ ì¶”ê°€)
            print(f"\nâœ“ í›ˆë ¨ ì´ë¯¸ì§€ ìˆ˜: {len(train_images):,}")
            # ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ê²½ë¡œ ì˜ˆì‹œ ì¶œë ¥
            print(f"  ì˜ˆì‹œ: {train_images[0]}")

        # --------------------------------------------------------------------
        # 1-3. test.txt ë¶„ì„
        # --------------------------------------------------------------------
        # test.txt: í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ì˜ ê²½ë¡œê°€ ì¤„ë§ˆë‹¤ í•˜ë‚˜ì”© ì €ì¥ë¨
        test_file = meta_dir / "test.txt"

        if test_file.exists():
            # íŒŒì¼ì„ ì½ì–´ì„œ ê° ì¤„(ì´ë¯¸ì§€ ê²½ë¡œ)ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì €ì¥
            with open(test_file, "r") as f:
                test_images = [line.strip() for line in f.readlines()]

            # í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ í†µê³„ ì¶œë ¥ (ì²œ ë‹¨ìœ„ êµ¬ë¶„ ì‰¼í‘œ ì¶”ê°€)
            print(f"âœ“ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ìˆ˜: {len(test_images):,}")
            # ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ê²½ë¡œ ì˜ˆì‹œ ì¶œë ¥
            print(f"  ì˜ˆì‹œ: {test_images[0]}")

    # ========================================================================
    # 2ë‹¨ê³„: Images ë””ë ‰í† ë¦¬ ë¶„ì„
    # ========================================================================
    # images ë””ë ‰í† ë¦¬: 101ê°œì˜ í´ë˜ìŠ¤ í´ë”ë¥¼ í¬í•¨
    # ê° í´ë˜ìŠ¤ í´ë”ëŠ” í•´ë‹¹ ìŒì‹ì˜ ì´ë¯¸ì§€ íŒŒì¼ë“¤(.jpg)ì„ í¬í•¨
    images_dir = dataset_path / "images"

    if images_dir.exists():
        print("\n\nğŸ–¼ï¸  ì´ë¯¸ì§€ ë””ë ‰í† ë¦¬ ë¶„ì„:")
        print("-" * 70)

        # --------------------------------------------------------------------
        # 2-1. í´ë˜ìŠ¤ í´ë” ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        # --------------------------------------------------------------------
        # iterdir()ë¡œ images ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  í•­ëª©ì„ ê°€ì ¸ì˜¤ê³ 
        # ë””ë ‰í† ë¦¬ë§Œ í•„í„°ë§í•˜ì—¬ ì •ë ¬
        class_dirs = sorted([d for d in images_dir.iterdir() if d.is_dir()])
        print(f"âœ“ í´ë˜ìŠ¤ í´ë” ìˆ˜: {len(class_dirs)}")

        # --------------------------------------------------------------------
        # 2-2. ìƒ˜í”Œ í´ë˜ìŠ¤ë“¤ì˜ ì´ë¯¸ì§€ ìˆ˜ í™•ì¸ (ì²˜ìŒ 10ê°œë§Œ)
        # --------------------------------------------------------------------
        class_image_counts = {}  # í´ë˜ìŠ¤ë³„ ì´ë¯¸ì§€ ê°œìˆ˜ë¥¼ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬
        print("\ní´ë˜ìŠ¤ë³„ ì´ë¯¸ì§€ ìˆ˜ ìƒ˜í”Œ (ì²˜ìŒ 10ê°œ):")

        # ì²˜ìŒ 10ê°œ í´ë˜ìŠ¤ë§Œ ìˆœíšŒ (ì „ì²´ë¥¼ ë‹¤ ì„¸ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼)
        for i, class_dir in enumerate(class_dirs[:10]):
            # glob("*.jpg")ë¡œ í•´ë‹¹ í´ë˜ìŠ¤ í´ë”ì˜ ëª¨ë“  .jpg íŒŒì¼ ì°¾ê¸°
            images = list(class_dir.glob("*.jpg"))
            # ë”•ì…”ë„ˆë¦¬ì— í´ë˜ìŠ¤ ì´ë¦„ê³¼ ì´ë¯¸ì§€ ìˆ˜ ì €ì¥
            class_image_counts[class_dir.name] = len(images)
            # í´ë˜ìŠ¤ ì´ë¦„ê³¼ ì´ë¯¸ì§€ ìˆ˜ ì¶œë ¥
            print(f"  {class_dir.name}: {len(images)} ì´ë¯¸ì§€")

        # --------------------------------------------------------------------
        # 2-3. ì „ì²´ í´ë˜ìŠ¤ì˜ ì´ë¯¸ì§€ ìˆ˜ í†µê³„ ê³„ì‚°
        # --------------------------------------------------------------------
        print("\nì „ì²´ í´ë˜ìŠ¤ ì´ë¯¸ì§€ ìˆ˜ í†µê³„ë¥¼ ê³„ì‚° ì¤‘...")
        all_counts = []  # ëª¨ë“  í´ë˜ìŠ¤ì˜ ì´ë¯¸ì§€ ìˆ˜ë¥¼ ë‹´ì„ ë¦¬ìŠ¤íŠ¸

        # ì´ë²ˆì—” 101ê°œ í´ë˜ìŠ¤ ì „ì²´ë¥¼ ìˆœíšŒ
        for class_dir in class_dirs:
            # ê° í´ë˜ìŠ¤ í´ë”ì—ì„œ .jpg íŒŒì¼ ê°œìˆ˜ ì„¸ê¸°
            images = list(class_dir.glob("*.jpg"))
            all_counts.append(len(images))

        # í†µê³„ ì •ë³´ ì¶œë ¥
        print(f"\nâœ“ ì „ì²´ ì´ë¯¸ì§€ ìˆ˜: {sum(all_counts):,}")  # ì´í•©
        print(f"âœ“ í´ë˜ìŠ¤ë‹¹ í‰ê·  ì´ë¯¸ì§€ ìˆ˜: {sum(all_counts) / len(all_counts):.1f}")  # í‰ê· 
        print(f"âœ“ ìµœì†Œ ì´ë¯¸ì§€ ìˆ˜: {min(all_counts)}")  # ê°€ì¥ ì ì€ í´ë˜ìŠ¤ì˜ ì´ë¯¸ì§€ ìˆ˜
        print(f"âœ“ ìµœëŒ€ ì´ë¯¸ì§€ ìˆ˜: {max(all_counts)}")  # ê°€ì¥ ë§ì€ í´ë˜ìŠ¤ì˜ ì´ë¯¸ì§€ ìˆ˜

    # ========================================================================
    # 3ë‹¨ê³„: ë°ì´í„°ì…‹ ìš”ì•½ ì •ë³´ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥
    # ========================================================================
    # ë¶„ì„ ê²°ê³¼ë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ì •ë¦¬
    summary = {
        "dataset_path": str(dataset_path),  # ë°ì´í„°ì…‹ ê²½ë¡œ
        # locals()ë¡œ í˜„ì¬ í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì—¬ ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ëŠ”ì§€ ì²´í¬
        "total_classes": len(classes) if 'classes' in locals() else 0,
        "train_images": len(train_images) if 'train_images' in locals() else 0,
        "test_images": len(test_images) if 'test_images' in locals() else 0,
        "total_images": sum(all_counts) if 'all_counts' in locals() else 0,
    }

    # JSON íŒŒì¼ë¡œ ì €ì¥ (ë“¤ì—¬ì“°ê¸° 2ì¹¸ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ)
    with open("dataset_summary.json", "w") as f:
        json.dump(summary, f, indent=2)

    # ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€
    print("\n" + "=" * 70)
    print("âœ“ ë°ì´í„°ì…‹ ìš”ì•½ ì •ë³´ê°€ 'dataset_summary.json'ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print("=" * 70)


# ============================================================================
# ë©”ì¸ ì‹¤í–‰ ë¸”ë¡
# ============================================================================
# ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ ì•„ë˜ ì½”ë“œê°€ ì‹¤í–‰ë¨
# (ë‹¤ë¥¸ íŒŒì¼ì—ì„œ importí•  ë•ŒëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ)
if __name__ == "__main__":
    # 1ë‹¨ê³„: ì €ì¥ëœ ë°ì´í„°ì…‹ ê²½ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
    dataset_path = load_dataset_path()

    # 2ë‹¨ê³„: ê²½ë¡œê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìœ¼ë©´ ë°ì´í„°ì…‹ íƒìƒ‰ ì‹œì‘
    if dataset_path:
        explore_food101_dataset(dataset_path)
